<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--命名空间应该是对应接口的包名+接口名 -->
<mapper namespace="com.travel.fj.dao.UserDao">
<!--详细到对应接口-->
    <insert id="createUser" parameterType="User">
        insert into tbl_user(user_name,user_pwd,user_sex,user_birthday,user_email,user_phone,user_note,user_pic) values (#{userName},#{userPwd},#{userSex},#{userBirthday},#{userEmail},#{userPhone},#{userNote},#{userPic})
    </insert>
    <select id="loadAllUser" resultType="User">
        select user_id,user_name,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user
    </select>

    <select id="loadQueryUser" resultType="User">
        select user_id,user_name,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user
        <trim prefix="WHERE" prefixOverrides="AND |OR ">
            <if test="helper.queryUserName != null">
                user_name like concat('%',#{helper.queryUserName},'%')
            </if>
            <if test="helper.queryUserSex != null">
                AND user_sex = #{helper.queryUserSex}
            </if>
            <if test="helper.queryUserStatus!= null">
                AND user_status = #{helper.queryUserStatus}
            </if>
        </trim>

    </select>

    <select id="loadQueryAndPageUser" resultType="User">
        select user_id,user_name,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user
        <trim prefix="WHERE" prefixOverrides="AND |OR ">
            <if test="helper.queryUserName != null">
                user_name like concat('%',#{helper.queryUserName},'%')
            </if>
            <if test="helper.queryUserSex != null">
                AND user_sex = #{helper.queryUserSex}
            </if>
            <if test="helper.queryUserStatus!= null">
                AND user_status = #{helper.queryUserStatus}
            </if>
        </trim>
        order by user_id asc limit #{startIndex},#{fetchSize}
    </select>

    <select id="getQueryUserCount" resultType="int">
        select COUNT(*)
        from tbl_user
        <trim prefix="WHERE" prefixOverrides="AND |OR ">
            <if test="helper.queryUserName != null">
                user_name like concat('%',#{helper.queryUserName},'%')
            </if>
            <if test="helper.queryUserSex != null">
                AND user_sex = #{helper.queryUserSex}
            </if>
            <if test="helper.queryUserStatus!= null">
                AND user_status = #{helper.queryUserStatus}
            </if>
        </trim>
    </select>

    <select id="getUserById" parameterType="int" resultType="User">
        select user_id,user_name,user_pwd,user_pic,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user where user_id=#{id}
    </select>

    <select id="getUserById1" parameterType="int" resultType="User">
        select user_id,user_name,user_pwd,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user where user_id=#{id}
    </select>

    <select id="getUserByName" parameterType="string" resultType="User">
        select user_id,user_name,user_pwd,user_pic,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user where user_name=#{name}
    </select>
    <select id="getUserByEmail" parameterType="string" resultType="User">
        select user_id,user_name,user_pwd,user_pic,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user where user_email=#{email}
    </select>
    <select id="getUserByPhone" parameterType="string" resultType="User">
        select user_id,user_name,user_pwd,user_pic,user_sex,user_birthday,user_email,user_phone,user_note,note_count,guide_count,user_status from tbl_user where user_phone=#{phone}
    </select>
    <select id="getUserPic" parameterType="int" resultMap="imgResultMap">
        select user_pic from tbl_user where user_id=#{id}
    </select>

    <select id="getNameList" resultType="string">
        select user_name from tbl_user;
    </select>

    <select id="getEmailList" resultType="string">
        select user_email from tbl_user;
    </select>

    <select id="getPhoneList" resultType="string">
        select user_phone from tbl_user;
    </select>

    <update id="updateUserPwd" parameterType="User">
        update  tbl_user
        <trim prefix="SET"
        suffixOverrides="," >
        <if test="userPwd!=null"> user_pwd = #{userPwd},</if>
    </trim>
    where user_id = #{userId}
    </update>
    <update id="updateUserInfo" parameterType="User">
        update tbl_user set user_name=#{userName},user_sex=#{userSex},user_birthday=#{userBirthday},user_email=#{userEmail},user_phone=#{userPhone},user_note=#{userNote},user_pic=#{userPic}
        where user_id=#{userId}
    </update>
    <update id="updateUserData" parameterType="User">
    update  tbl_user
    <trim prefix="SET"
          suffixOverrides="," >
        <if test="noteCount!=null"> note_count = #{noteCount},</if>
        <if test="guideCount!=null"> guide_count = #{guideCount},</if>
    </trim>
        where user_id = #{userId}
    </update>
    <update id="updateUserStatus" parameterType="User">
        update tbl_user set user_status=#{userStatus}
        where user_id=#{userId}
    </update>



    <resultMap type="java.util.Map" id="imgResultMap" >
        <result   column="user_pic" property="imgBytes" jdbcType="BLOB" typeHandler="org.apache.ibatis.type.BlobTypeHandler"/>
    </resultMap>
</mapper>